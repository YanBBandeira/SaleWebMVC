@model IEnumerable<SalesWebMVC.Models.ViewModels.ProfilesIndexViewModel>;

@{
    ViewData["Title"] = "Profiles";
}

<h2>@ViewData["Title"]</h2>
@if (TempData["Error"] != null)
{
    <div class="alert alert-danger">@TempData["Error"]</div>
}
<p class="mb-2">
    <a class="btn btn-success" asp-action="Create">Create New</a>
</p>
<table id="usersTable" class="table table-striped" style="width:100%">
    <thead>
        <tr>
            <th>Name</th>
            <th>Login</th>
            <th>Email</th>
            <th>Role</th>
            <th></th>
        </tr>
    </thead>
    <tbody>
        @foreach (var item in Model)
        {
            <tr class="table-light">
                <td>@Html.DisplayFor(modelItem => item.Name)</td>
                <td>@Html.DisplayFor(modelItem => item.Login)</td>
                <td>@Html.DisplayFor(modelItem => item.Email)</td>
                <td>@Html.DisplayFor(modelItem => item.Role)</td>
                <td class="text-end">
                    @* Mostrar botão excluir apenas se NÃO for Admin *@
                    @if (item.Role != "Admin"){
                    <a class="btn btn-sm btn-outline-info" asp-action="Edit" asp-route-id="@item.Id"> <i class="bi bi-pencil-square"></i></a>
                    
                        <form asp-action="Delete" asp-route-id="@item.Id" method="post" class="d-inline" onsubmit="return confirm('Are you sure?');">
                            <button type="submit" class="btn btn-sm btn-danger"><i class="bi bi-trash"></i></button>
                        </form>
                    }
                </td>
            </tr>
        }
    </tbody>
</table>

@section Scripts {
    <script>
        $(document).ready(function () {
            $('#usersTable').DataTable({
                dom: '<"d-flex justify-content-between mb-3"lfB>rtip', // layout customizado
                 buttons: [],
                columnDefs: [
                    { orderable: false, targets: 3 }
                ],
                pageLength: 10,
                lengthMenu: [[5, 10, 25, 50, -1], [5, 10, 25, 50, "All"]],
                lengthChange: true,
                info: true,
                rowReorder: true,
                initComplete: function () {
                    $('.dataTables_filter input')
                        .addClass('form-control form-control-sm d-inline-block ms-2')
                        .attr('placeholder', '🔍 Search...');

                    $('.dataTables_length select')
                        .addClass('form-select form-select-sm d-inline-block ms-2');
                },
                drawCallback: function () {
                    $('.dataTables_paginate .paginate_button')
                        .addClass('btn btn-sm btn-outline-primary mx-1');

                    $('.dataTables_paginate .paginate_button.current')
                        .removeClass('btn-outline-primary')
                        .addClass('btn-primary text-white');
                }
            });
        });
    </script>
}
